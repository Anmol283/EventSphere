<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Storage Testing - Event Sphere</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 50px 0;
        }
        .card {
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        .console-output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
        }
        .btn-test {
            margin: 5px;
        }
        .storage-type {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 8px;
        }
        .local { background: #28a745; color: white; }
        .session { background: #17a2b8; color: white; }
        .redis { background: #dc3545; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h3 class="mb-0">
                            <i class="fas fa-database me-2"></i>Storage Testing Dashboard
                        </h3>
                        <small>Test localStorage, sessionStorage, and Redis integration</small>
                    </div>
                    <div class="card-body">
                        <!-- Storage Type Indicators -->
                        <div class="mb-4">
                            <span class="storage-type local">localStorage</span> Persistent (survives browser close)
                            <br>
                            <span class="storage-type session">sessionStorage</span> Tab-specific (cleared when tab closes)
                            <br>
                            <span class="storage-type redis">Redis Session</span> Server-side (synced across devices)
                        </div>

                        <!-- Test Buttons -->
                        <div class="row mb-4">
                            <div class="col-md-4">
                                <h5><i class="fas fa-save text-success me-2"></i>localStorage Tests</h5>
                                <button class="btn btn-success btn-sm btn-test w-100" onclick="testLocal()">
                                    <i class="fas fa-save me-2"></i>Save to localStorage
                                </button>
                                <button class="btn btn-info btn-sm btn-test w-100" onclick="getLocal()">
                                    <i class="fas fa-eye me-2"></i>Get from localStorage
                                </button>
                                <button class="btn btn-warning btn-sm btn-test w-100" onclick="saveWithExpiry()">
                                    <i class="fas fa-clock me-2"></i>Save with Expiry (5min)
                                </button>
                            </div>
                            <div class="col-md-4">
                                <h5><i class="fas fa-window-maximize text-info me-2"></i>sessionStorage Tests</h5>
                                <button class="btn btn-info btn-sm btn-test w-100" onclick="testSession()">
                                    <i class="fas fa-save me-2"></i>Save to sessionStorage
                                </button>
                                <button class="btn btn-primary btn-sm btn-test w-100" onclick="getSession()">
                                    <i class="fas fa-eye me-2"></i>Get from sessionStorage
                                </button>
                                <button class="btn btn-secondary btn-sm btn-test w-100" onclick="trackPage()">
                                    <i class="fas fa-chart-line me-2"></i>Track Page View
                                </button>
                            </div>
                            <div class="col-md-4">
                                <h5><i class="fas fa-server text-danger me-2"></i>Redis Session Tests</h5>
                                <button class="btn btn-danger btn-sm btn-test w-100" onclick="testRedis()">
                                    <i class="fas fa-save me-2"></i>Save to Redis
                                </button>
                                <button class="btn btn-warning btn-sm btn-test w-100" onclick="getRedis()">
                                    <i class="fas fa-eye me-2"></i>Get from Redis
                                </button>
                                <button class="btn btn-primary btn-sm btn-test w-100" onclick="getAllRedis()">
                                    <i class="fas fa-list me-2"></i>Get All Session Data
                                </button>
                            </div>
                        </div>

                        <!-- More Actions -->
                        <div class="row mb-4">
                            <div class="col-md-12">
                                <h5><i class="fas fa-flask text-primary me-2"></i>Advanced Tests</h5>
                                <button class="btn btn-primary btn-test" onclick="runDemo()">
                                    <i class="fas fa-play me-2"></i>Run Full Demo
                                </button>
                                <button class="btn btn-info btn-test" onclick="showStats()">
                                    <i class="fas fa-chart-bar me-2"></i>Show Storage Stats
                                </button>
                                <button class="btn btn-success btn-test" onclick="trackEvent()">
                                    <i class="fas fa-ticket-alt me-2"></i>Track Event Visit
                                </button>
                                <button class="btn btn-warning btn-test" onclick="saveForm()">
                                    <i class="fas fa-file-alt me-2"></i>Save Form Data
                                </button>
                                <button class="btn btn-danger btn-test" onclick="clearAll()">
                                    <i class="fas fa-trash me-2"></i>Clear All Storage
                                </button>
                            </div>
                        </div>

                        <!-- Console Output -->
                        <h5><i class="fas fa-terminal text-warning me-2"></i>Console Output</h5>
                        <div class="console-output" id="console">
                            <div>üöÄ Storage Manager Ready!</div>
                            <div>üí° Click buttons above to test storage functionality</div>
                            <div>‚úÖ Check Browser Console (F12) for detailed logs</div>
                            <div>‚úÖ Check DevTools ‚Üí Application ‚Üí Storage to see data</div>
                        </div>

                        <!-- Instructions -->
                        <div class="alert alert-info mt-4">
                            <h5><i class="fas fa-info-circle me-2"></i>How to Verify in Browser Console</h5>
                            <ol>
                                <li>Press <kbd>F12</kbd> to open DevTools</li>
                                <li>Go to <strong>Application</strong> tab</li>
                                <li>Expand <strong>Storage</strong> in the left sidebar:
                                    <ul>
                                        <li><strong>Local Storage</strong> ‚Üí http://localhost:3000</li>
                                        <li><strong>Session Storage</strong> ‚Üí http://localhost:3000</li>
                                    </ul>
                                </li>
                                <li>You'll see keys starting with <code>eventsphere_</code></li>
                                <li>Go to <strong>Console</strong> tab to see detailed logs</li>
                                <li>Type <code>storage.getStats()</code> in console to see all data</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/storage.js"></script>
    
    <script>
        const consoleDiv = document.getElementById('console');
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.textContent = message;
            div.style.color = type === 'success' ? '#4caf50' : 
                             type === 'error' ? '#f44336' : 
                             type === 'warning' ? '#ff9800' : '#d4d4d4';
            consoleDiv.appendChild(div);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        function testLocal() {
            const data = { user: 'John Doe', email: 'john@example.com', timestamp: new Date().toISOString() };
            storage.setLocal('test_user', data);
            log('‚úÖ Saved to localStorage: test_user', 'success');
        }

        function getLocal() {
            const data = storage.getLocal('test_user');
            log('üìñ Retrieved from localStorage: ' + JSON.stringify(data), 'info');
        }

        function saveWithExpiry() {
            storage.setLocalWithExpiry('temp_token', 'abc123xyz', 5);
            log('‚úÖ Saved with 5-minute expiry: temp_token', 'success');
        }

        function testSession() {
            const data = { cart: ['Ticket 1', 'Ticket 2'], total: 50 };
            storage.setSession('test_cart', data);
            log('‚úÖ Saved to sessionStorage: test_cart', 'success');
        }

        function getSession() {
            const data = storage.getSession('test_cart');
            log('üìñ Retrieved from sessionStorage: ' + JSON.stringify(data), 'info');
        }

        function trackPage() {
            storage.trackPageViews();
            log('üìä Page view tracked', 'success');
        }

        async function testRedis() {
            const data = { message: 'Hello from Redis!', timestamp: new Date().toISOString() };
            await storage.saveToServer('test_redis_data', data);
            log('‚úÖ Saved to Redis: test_redis_data', 'success');
        }

        async function getRedis() {
            const data = await storage.getFromServer('test_redis_data');
            log('üìñ Retrieved from Redis: ' + JSON.stringify(data), 'info');
        }

        async function getAllRedis() {
            const data = await storage.getAllServerSession();
            log('üìä All session data: ' + JSON.stringify(data, null, 2), 'info');
        }

        async function runDemo() {
            log('üéØ Running full demo...', 'warning');
            await storage.demo();
            log('‚úÖ Demo complete! Check console for details', 'success');
        }

        function showStats() {
            const stats = storage.getStats();
            log('üìä Storage Stats: ' + JSON.stringify(stats, null, 2), 'info');
        }

        function trackEvent() {
            storage.trackEventVisit('evt123', 'Music Festival 2025');
            log('üé´ Event visit tracked', 'success');
        }

        function saveForm() {
            const formData = { name: 'John', email: 'john@example.com', message: 'Hello!' };
            storage.saveFormData('contact_form', formData);
            log('üìù Form data saved for recovery', 'success');
        }

        function clearAll() {
            if (confirm('Clear ALL storage? This cannot be undone.')) {
                storage.clearAll();
                storage.clearSessionAll();
                log('üßπ All storage cleared', 'warning');
            }
        }

        // Initial log
        log('‚ú® Storage Manager initialized and ready!', 'success');
        log('üí° Try: storage.demo() in console', 'info');
    </script>
</body>
</html>
